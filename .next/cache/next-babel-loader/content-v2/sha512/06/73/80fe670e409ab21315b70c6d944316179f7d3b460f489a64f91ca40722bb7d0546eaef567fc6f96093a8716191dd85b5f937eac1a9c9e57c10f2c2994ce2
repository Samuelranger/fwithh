{"ast":null,"code":"import jwt from \"jsonwebtoken\";\nimport Cart from \"../../models/Cart\";\nimport Order from \"../../models/Order\";\nexport default (async (req, res) => {\n  const {\n    email,\n    cartTotal\n  } = req.body; // console.log(req.body);\n\n  try {\n    const {\n      userId\n    } = jwt.verify(req.headers.authorization, process.env.JWT_SECRET);\n    const cart = await Cart.findOne({\n      user: userId\n    }).populate({\n      path: \"products.product\",\n      model: \"Product\"\n    });\n    await new Order({\n      user: userId,\n      email,\n      total: cartTotal,\n      products: cart.products\n    }).save();\n    await Cart.findOneAndUpdate({\n      _id: cart._id\n    }, {\n      $set: {\n        products: []\n      }\n    });\n    res.status(200).send(\"Checkout successful!\");\n  } catch (error) {\n    console.error(error);\n    res.status(500).send(\"Error proccessing charge\");\n  }\n});","map":null,"metadata":{},"sourceType":"module"}